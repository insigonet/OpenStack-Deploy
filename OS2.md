
---
### **Слайд 14: «Инициализация окружения OpenStack»**
#### **Основные фразы для слайда:**

- Активация виртуального окружения
- Загрузка переменных окружения OpenStack.

> Начнём нашу работу с инициализации окружения. Это необходимо для работы с инструментами командной строки OpenStack.

```bash
source ~/venv/bin/activate && source ~/admin-openrc.sh
```
> Эта команда активирует виртуальное окружение Python, которое содержит необходимые пакеты для работы с OpenStack CLI, и загружает переменные окружения с учётными данными администратора.*
> Выполнив эту команду, мы подготавливаем нашу среду для взаимодействия с OpenStack через командную строку.
> Виртуальное окружение позволяет изолировать зависимости, а в переменных окружения содержатся необходимые кредды для аутентификации.

---

### **Слайд 15: «Структура системы и расположение файлов»**
#### **Основные фразы для слайда:**

- Конфигурационные файлы Kolla-Ansible
- Расположение файлов конфигурации и инвентаря
- Структура директорий и логов
- Практические команды для демонстрации

> Давайте рассмотрим, как настроена наша система и где находятся основные файлы.

```bash
sudo ls /etc/kolla
```
> Эта команда показывает содержимое каталога `/etc/kolla`. В этом каталоге хранятся конфигурационные файлы Kolla-Ansible для сервисов OpenStack.
> Также здесь находятся конфигурационныq файл `globals.yml` и `inventory`.

```bash
cat /etc/kolla/globals.yml
```
> В файле `globals.yml` содержатся глобальные настройки нашей OpenStack установки. Здесь мы можем увидеть такие параметры как :

- Базовый дистрибутив (Ubuntu)
- Версия OpenStack (2023.2)
- Настройки сетевых интерфейсов и VIP-адресов
- Включенные и отключенные сервисы

```bash
cat /etc/kolla/inventory
```

> В инвентарном файле перечислены все узлы нашей OpenStack установки и указаны их роли.

```bash
sudo ls /var/log/kolla
```

> Логи сервисов хранятся в `/var/log/kolla`. Здесь мы можем найти логи различных сервисов OpenStack необходимые для диагностики и мониторинга.

---

### **Слайд 16: «Диагностика текущих сервисов OpenStack»**
#### **Основные фразы для слайда:**

- Проверка состояния сервисов OpenStack
- Анализ запущенных контейнеров
- Практические примеры диагностики

```bash
docker ps -a
```

> Эта команда показывает все Docker-контейнеры, их статус и связанные образы.*
> В выводе команды мы видим список всех контейнеров OpenStack, запущенных Kolla-Ansible.

- `nova_compute` — отвечает за запуск виртуальных машин
- `neutron_server` — управляет сетевыми функциями
- `glance_api` — предоставляет доступ к образам виртуальных машин

**Команда для проверки состояния агентов Neutron:**

```bash
openstack network agent list
```

> Эта команда показывает состояние агентов Neutron, таких как DHCP, L3, Metadata и Open vSwitch агент.*
- `DHCP agent — агент`, управляющий DHCP для сетей.
- `L3 agent — агент`, управляющий маршрутизацией между сетями.
- `Open vSwitch agent` — агент, управляющий сетевыми правилами для Open vSwitch.
- `Metadata agent — агент`, отвечающий за предоставление метаданных виртуальным машинам.

> Тут мы видим, что все агенты Neutron находятся в состоянии "UP" и работают корректно.

```bash
openstack service list --long
```
> Эта команда отображает список всех зарегестрированных сервисов OpenStack

- `heat-cfn (cloudformation)` — Сервис оркестрации, поддерживающий шаблоны AWS CloudFormation.
- `keystone (identity)` — Сервис управления идентификацией и аутентификацией пользователей (единую аутентификацию для всех компонентов OpenStack).
- `heat (orchestration)` — Сервис оркестрации, который позволяет автоматизировать создание и управление инфраструктурой с помощью шаблонов (стеков).
- `neutron (network)` — Сервис управления виртуальными сетями в OpenStack, который предоставляет сетевые функции для виртуальных машин.
- `placement (placement)` — Сервис для управления и распределения ресурсов (CPU, память, диски) между виртуальными машинами.
- `glance (image)` — Сервис управления образами виртуальных машин (хранилище и предоставление образов для запуска).
- `cinderv3 (volumev3)` — Сервис блочного хранилища, который предоставляет управление дисковыми томами для виртуальных машин.
- `nova (compute)` — Основной сервис управления вычислительными ресурсами, отвечающий за запуск и управление виртуальными машинами

```bash
openstack compute service list; openstack volume service list; openstack network agent list
```
> Так мы можем посмотреть статус нужных нам сервисов

```bash
openstack hypervisor list
```
> Эта команда отображает список гипервизоров и их состояние.

---
### **Слайд 17: «Пример изменения конфигурации OpenStack»**
#### **Основные фразы для слайда:**

- Обновление конфигурации с помощью Kolla-Ansible
- Пример изменения параметра debug для Nova
- Обновление контейнеров до новой конфигурации

> Иногда возникает необходимость внести изменения в конфигурацию OpenStack. Я покажу это на примере изменения уровня логирования для сервиса Nova.
>
> В Kolla-Ansible изменения напрямую в файлах конфигурации сервисов не применяются
> Для изменения конфигурации необходимо использовать механизм переопределения конфигурации с помощью дополнительных файлов конфигов.

```bash
mkdir -p /etc/kolla/config/nova/
sudo nano /etc/kolla/config/nova/nova-compute.conf
```

> Мы открываем конфигурационный файл Nova для редактирования и добавляем новые параменты для `debug` и устанавливаем его значение на `true`:

```ini
[DEFAULT]
debug = true
```
> Установка `debug = true` увеличивает подробность логирования для сервиса Nova. Это полезно для диагностики и отладки, так как позволяет получать более детальную информацию о работе сервиса. Однако рекомендуется использовать данный режим временно, только для целей диагностики.

```bash
kolla-ansible -i /etc/kolla/inventory reconfigure -t nova
```

> Kolla-Ansible применит изменения конфигурации для сервиса Nova и перезапустит соответствующие контейнеры. Это происходит без простоя других сервисов.
> Флаг `-t nova` указывает, что мы хотим применить изменения только для сервиса Nova.*

```bash
sudo docker exec nova_compute grep debug /etc/nova/nova.conf
```
> Тут мы можетм видеть что параментры применены

** Дополнительно **
```bash
sudo nano /etc/kolla/config/nova.conf

sudo docker exec -it nova_compute bash
grep debug /etc/nova/nova.conf
exit

sudo docker exec -it nova_api bash
grep debug /etc/nova/nova.conf
exit

sudo docker exec -it nova_scheduler bash
grep debug /etc/nova/nova.conf
exit
```

---
### **Слайд 18: «Мониторинг и логирование в OpenStack»**
#### **Основные фразы для слайда:**

- Использование логов для диагностики
- Мониторинг сервисов через командную строку
- Практические примеры мониторинга

**Текст презентации:**

> Аанализ логов являются ключевыми моментом для поддержания стабильной работы OpenStack и для поиска проблем.

**Пример: Просмотр логов сервиса Nova**

```bash
sudo tail -f /var/log/kolla/nova/nova-compute.log
```

**Мониторинг состояния сервисов используя команды OpenStack:**

```bash
openstack hypervisor stats show
```
> Команда выводит статистику использования ресурсов, таких как количество ядер CPU, объем памяти и дискового пространства.
> Мы получаем информацию о загрузке нашего гипервизора

**Использование команд для проверки состояния виртуальных машин:**

```bash
openstack server list --all-projects
```
```bash
openstack server list --long --all-projects
```
```bash
openstack server show 4ba83d07-1c3b-4774-8ed7-853a5c654a36
```

> Команда выводит расширенную информацию о виртуальных машинах, включая статус, использованные ресурсы.*
> Это помогает отслеживать состояние виртуальных машин, выявлять зависшие или некорректно работающие инстансы.

- `ACTIVE` — Виртуальная машина работает нормально.
- `SHUTOFF` — Виртуальная машина была выключена, либо вручную, либо по ошибке.
- `ERROR` — Указывает на то, что произошла ошибка при создании или запуске ВМ.
- `PAUSED, SUSPENDED` — ВМ приостановлена или заморожена.
- `BUILD` — ВМ находится в процессе создания, но если она застряла в этом статусе на долгое время, это может быть признаком проблемы.
- `REBOOT, RESCUE, REBUILD` — ВМ перезагружается, восстанавливается или пересобирается, и если это состояние длительное время не меняется, это тоже может быть проблемой

---

### **Слайд 19: «Загрузка нового образа в Glance»**
#### **Основные фразы для слайда:**

- Добавление образа Ubuntu 24.04v2 в Glance
- Проверка доступных образов
- Практический пример

> Для примера мы загрузим новый образ операционной системы в сервис Glance для использования при создании виртуальных машин.

```bash
openstack image create --disk-format qcow2 --container-format bare --file ./ISO/noble-server-cloudimg-amd64.img Ubuntu-24.04v2
```

> Мы загрузили новый образ `Ubuntu-24.04v2` и он доступен для использования.

```bash
openstack image list
```
> Мы видим обновленный список образов, включая только что загруженный образ. Теперь мы можем использовать его при создании новых виртуальных машин.

---
### **Слайд 20: «Просмотр сетей и групп безопасности»**
#### **Основные фразы для слайда:**

- Проверка доступных сетей
- Просмотр групп безопасности
- Вывод правил группы безопасности

> Давайте посмотрим, какие сети и группы безопасности доступны в нашей системе.

```bash
openstack network list
```
> Команда показывает список сетей, доступных в OpenStack. Например, сеть `external_network`.

```bash
openstack security group list
```
> Мы видим список групп безопасности, включая группу с ID `4e096426-0d71-4b1d-b745-c787dcafff22`, которую будем использовать при создании виртуальной машины.

```bash
openstack security group rule list 4e096426-0d71-4b1d-b745-c787dcafff22
```
Команда отображает все правила, связанные с данной группой безопасности. Мы можем увидеть разрешенные входящие и исходящие порты, протоколы и направления трафика.

---
### **Слайд 21: «Интеграция с HostBill»**
#### **Основные фразы для слайда:**

- Создание виртуальной машины из HostBill
- Управление виртуальными машинами HostBill через CLI
- Практические команды для диагностики

> Наш OpenStack интегрирован с системой биллинга HostBill, это позволяет автоматизировать процесс создания виртуальных машин для пользователей из личного кабинета на OpenStack.

**Создание виртуальной машины из HostBill:**

> Сейчас мы создадимю виртуальную машину из панели HostBill и после создания мы сможем управлять этой VM через OpenStack CLI.

**Создаем виртуальную машину в HostBill:**

> После создания виртуальной машины из HostBill мы можем увидеть её в списке виртуальных машин и управлять ею так же, как и любыми другими VM.
```bash
openstack server list --all-projects
```
```bash
openstack user list
openstack role assignment list --user b556681bd33341859b0c6cf44f1884d7 --names
openstack server list --project 32a6ef3d00db42f2b55455203a258853
```

---
### **Слайд 22: «Управление виртуальными машинами и пользователями»**
#### **Основные фразы для слайда:**

- Вывод всех пользователей
- Определение владельцев виртуальных машин
- Практические команды для администрирования

```bash
openstack user list
```
> Мы получаем список всех пользователей, зарегистрированных в OpenStack.

**Вывод проектов пользователя `hb_client_51_1`:**
```bash
openstack role assignment list --user b556681bd33341859b0c6cf44f1884d7 --names
```
> Команда показывает, какие проекты, доменах и роли имеет этот пользователь

```bash
openstack server list --project 32a6ef3d00db42f2b55455203a258853
```
> Мы получаем список VM по ID проекта.

**Шаг 2: Вывод виртуальных машин пользователя:**

```bash
openstack server list --all-projects
```
> Команда показывает все виртуальные машины, включая только что созданную из HostBill.

```bash
openstack console log show vm-demo
```
> Эта команда выводит консольные логи виртуальной машины

```bash
openstack console url show vm-demo
```
> Команда выводит URL для доступа к консоли виртуальной машины через веб-браузер

***Команды для управления виртуальной машиной:***
```bash
# Остановка:
openstack server stop vm-demo

# Запуск:
openstack server start vm-demo

# Перезагрузка:
openstack server reboot vm-demo
Текст после команд:

Уудаления виртуальной машины:
openstack server delete vm-demo
```

***Дополнительно***
```bash
openstack user list
openstack role assignment list --user b556681bd33341859b0c6cf44f1884d7 --names
openstack server list --project 32a6ef3d00db42f2b55455203a258853
```

---

**Слайд 23: «Планы на будущее и заключение»**

**Основные фразы для слайда:**

- Добавление нового вычислительного узла и сервисов
- Балансировка нагрузки и высокая доступность сервисов
- Бэкап и восстановление

**Текст презентации:**

> На следующей презентации мы рассмотрим процесс добавления нового узла `w1-node-02` в кластер, включая подготовку сервера, настройку инвентаря и развертывание дополнительных сервисов на новом узле.

**Мы расмотри**
- Создание внутренних сетей и роутеров:**
- Балансировка нагрузки и высокая доступность
- Рассмотрим стратегии резервного копирования данных и восстановления системы в случае сбоев.

**Заключение:**
> В следующей презентации мы углубимся в более сложные темы и продемонстрируем их на практике.
